<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transmission Line Calculator Docs</title>
    <style>
        /* --- Root Variables (Theming) --- */
        :root {
            --bg-body: #f7f9fc;
            --bg-sidebar: #ffffff;
            --bg-content: #ffffff;
            --bg-code: #2b2b2b;
            --bg-code-header: #3a3a3a;
            --bg-highlight: #fffbe6;
            --bg-math: #f9faff;
            
            --text-primary: #2c3e50;
            --text-secondary: #5a687b;
            --text-header: #003a6c;
            --text-code: #f1f1f1;
            
            --border-color: #dfe3e8;
            --shadow-light: 0 4px 12px rgba(0,0,0,0.05);
            --shadow-strong: 0 6px 16px rgba(0,0,0,0.08);

            --accent: #0078d4;
            --accent-hover: #005a9e;
            --accent-active-bg: #e5f1fb;
            --accent-active-border: #0078d4;
        }
        
        /* --- General Setup --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            font-size: 16px;
            line-height: 1.7;
            background-color: var(--bg-body);
            color: var(--text-primary);
            display: flex;
        }

        /* --- Sidebar Navigation --- */
        .sidebar {
            width: 280px;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            background-color: var(--bg-sidebar);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            transition: width 0.3s ease;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-header h1 {
            font-size: 20px;
            font-weight: 700;
            color: var(--header);
            line-height: 1.3;
        }
        .sidebar-header h1 span {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            display: block;
        }

        .sidebar-nav {
            padding: 16px;
        }

        .sidebar-nav ul {
            list-style: none;
        }

        .sidebar-nav li {
            margin-bottom: 4px;
        }

        .sidebar-nav a {
            text-decoration: none;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            display: block;
            padding: 10px 16px;
            border-radius: 6px;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .sidebar-nav a:hover {
            background-color: var(--bg-body);
            color: var(--text-primary);
        }

        .sidebar-nav li.active > a {
            background-color: var(--accent-active-bg);
            color: var(--accent);
            font-weight: 600;
            border-left-color: var(--accent-active-border);
        }
        
        .sidebar-nav .nav-h2 a {
            padding-left: 32px;
            font-size: 13px;
        }
        
        .sidebar-nav .nav-h3 a {
            padding-left: 48px;
            font-size: 12px;
            font-weight: 400;
            color: #777;
        }

        /* --- Main Content Area --- */
        .content {
            margin-left: 280px;
            flex: 1;
            padding: 48px;
        }

        .content-wrapper {
            max-width: 900px;
            margin: 0 auto;
            background-color: var(--bg-content);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: var(--shadow-light);
        }
        
        .content section {
            padding: 40px 48px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .content section:last-child {
            border-bottom: none;
        }

        h1, h2, h3, h4 {
            color: var(--text-header);
            margin-bottom: 20px;
            line-height: 1.3;
        }
        
        h1 {
            font-size: 36px;
            font-weight: 800;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        h2 {
            font-size: 28px;
            font-weight: 700;
            margin-top: 32px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        h3 {
            font-size: 22px;
            font-weight: 600;
            margin-top: 24px;
        }
        
        h4 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-top: 20px;
        }

        p {
            margin-bottom: 16px;
        }

        ul, ol {
            margin-bottom: 16px;
            padding-left: 24px;
        }
        
        li {
            margin-bottom: 10px;
        }

        /* --- Code & Formatting --- */
        code:not(pre code) {
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.9em;
            background-color: #f0f4f8;
            padding: 3px 6px;
            border-radius: 4px;
            color: #c7254e;
            border: 1px solid var(--border-color);
        }
        
        .code-block-wrapper {
            position: relative;
            margin-bottom: 16px;
        }

        pre {
            background-color: var(--bg-code);
            color: var(--text-code);
            padding: 20px;
            padding-top: 16px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .code-block-wrapper .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4a4a4a;
            color: #f1f1f1;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.2s ease;
        }
        
        .code-block-wrapper:hover .copy-btn {
            opacity: 1;
        }
        
        .copy-btn:hover {
            background: #5a5a5a;
        }
        
        .copy-btn.copied {
            background: #28a745;
        }
        
        .highlight {
            padding: 16px;
            background: var(--bg-highlight);
            border: 1px solid #ffe58f;
            border-radius: 5px;
            margin-bottom: 16px;
        }
        
        .highlight strong {
            color: #d46b08;
        }
        
        img.math-formula {
            display: block;
            max-width: 100%;
            height: auto;
            background: var(--bg-math);
            padding: 24px;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            margin: 24px auto;
        }
        
        .api-def {
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 15px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .api-def strong {
            color: var(--accent);
        }
        
        .api-def code {
            color: #005a9e;
            background: #e5f1fb;
            border: 1px solid #b3d6f2;
        }

    </style>
</head>
<body>
    
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1>
                GMRGMDTEST.py
                <span>App Documentation</span>
            </h1>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li data-scroll-spy="overview"><a href="#overview">Overview</a></li>
                <li data-scroll-spy="user-guide"><a href="#user-guide">User Guide</a>
                    <ul>
                        <li class="nav-h2" data-scroll-spy="guide-step1"><a href="#guide-step1">1. Setup Parameters</a></li>
                        <li class="nav-h2" data-scroll-spy="guide-step2"><a href="#guide-step2">2. Place Conductors</a></li>
                        <li class="nav-h2" data-scroll-spy="guide-step3"><a href="#guide-step3">3. Review Results</a></li>
                        <li class="nav-h2" data-scroll-spy="guide-step4"><a href="#guide-step4">4. Export Solution</a></li>
                    </ul>
                </li>
                <li data-scroll-spy="api-reference"><a href="#api-reference">API Reference</a>
                    <ul>
                        <li class="nav-h2" data-scroll-spy="api-backend"><a href="#api-backend">Python Backend</a></li>
                        <li class="nav-h3" data-scroll-spy="api-backend-class"><a href="#api-backend-class">GMDGMRApp</a></li>
                        <li class="nav-h3" data-scroll-spy="api-backend-methods"><a href="#api-backend-methods">Backend Methods</a></li>
                        <li class="nav-h2" data-scroll-spy="api-frontend"><a href="#api-frontend">JavaScript Frontend</a></li>
                        <li class="nav-h3" data-scroll-spy="api-frontend-state"><a href="#api-frontend-state">Global State</a></li>
                        <li class="nav-h3" data-scroll-spy="api-frontend-events"><a href="#api-frontend-events">Core Events</a></li>
                        <li class="nav-h3" data-scroll-spy="api-frontend-drawing"><a href="#api-frontend-drawing">Drawing Loop</a></li>
                    </ul>
                </li>
                <li data-scroll-spy="math-hub"><a href="#math-hub">Mathematical Hub</a>
                    <ul>
                        <li class="nav-h2" data-scroll-spy="math-gmr"><a href="#math-gmr">GMR / Self GMD</a></li>
                        <li class="nav-h2" data-scroll-spy="math-gmd"><a href="#math-gmd">GMD / Mutual GMD</a></li>
                        <li class="nav-h2" data-scroll-spy="math-rlc"><a href="#math-rlc">Line Parameters (R, L, C)</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </aside>

    <main class="content">
        <div class="content-wrapper">

            <section id="overview">
                <h1>Transmission Line Calculator</h1>
                <p>
                    This application is a powerful, interactive desktop tool for calculating the electrical parameters of overhead transmission lines. It's designed for electrical engineering students and professionals who need to quickly model and analyze conductor configurations.
                </p>
                <p>
                    By providing a visual canvas to place conductors and a real-time results panel, it bridges the gap between theoretical formulas and practical design. The entire application is a self-contained Python file (`GMRGMDTEST.py`) that runs a modern web-based UI in a native desktop window.
                </p>
                
                <h3>Core Technologies</h3>
                <ul>
                    <li><strong>Python 3:</strong> The backbone of the application, performing all complex mathematical calculations and managing the application's state.</li>
                    <li><strong><code>pywebview</code>:</strong> A lightweight cross-platform wrapper that serves the HTML/CSS/JS frontend and creates a two-way API bridge between Python and JavaScript.</li>
                    <li><strong><code>numpy</code>:</strong> Used for high-performance numerical operations, especially Euclidean distance calculations.</li>
                    <li><strong>HTML5 Canvas:</strong> Renders the interactive 2D grid, conductors, and real-time visual feedback (preview lines, snap halos).</li>
                    <li><strong><code>google.generativeai</code>:</strong> Integrated to provide AI-powered, on-demand generation of detailed LaTeX solution documents.</li>
                </ul>
            </section>

            <section id="user-guide">
                <h1>User Guide</h1>
                <p>The application interface features a 3-panel layout: **Controls (Left)**, **Canvas (Center)**, and **Results (Right)**. The workflow is designed to be intuitive, moving from left to right.</p>

                <h2 id="guide-step1">Step 1: Setup Parameters (Left Panel)</h2>
                <p>This is where you define the physical properties of your line.</p>
                
                <h4>Active Bundle</h4>
                <p>Select which phase (Bundle A, B, or C) you are currently adding conductors for. This selection dictates where your clicks on the canvas will be registered.</p>
                
                <h4>Geometry Settings</h4>
                <ul>
                    <li><strong>Distance Units:</strong> Choose the unit (m, ft, inch, etc.) for all your inputs on the canvas and in the radius boxes. All calculations are automatically converted to meters on the backend.</li>
                    <li><strong>Radius A/B/C (in Units):</strong> Enter the <em>physical radius</em> (r) of a single conductor for each bundle.</li>
                    <li><strong>Apply Radii:</strong> Click this to commit the radii. The backend uses this to calculate the single-conductor GMR ($r'$) for each bundle.</li>
                </ul>
                
                <h4>Line Parameters</h4>
                <ul>
                    <li><strong>Material:</strong> Select the conductor material (e.g., Copper, ACSR) to determine its resistivity ($\rho$) for resistance calculations.</li>
                    <li><strong>Line Length (km):</strong> The total length of the transmission line.</li>
                    <li><strong>Conductor Radius (m):</strong> The master physical radius in **meters**. This value is used for Resistance and Capacitance.</li>
                    <li><strong>Calculate Parameters:</strong> Clicking this updates all backend parameters and **synchronizes the Radius A/B/C boxes** with the new master radius.</li>
                </ul>
                
                <div class="highlight">
                    <strong>Pro Tip:</strong> For simplicity, set the <strong>Conductor Radius (m)</strong> and click <strong>"Calculate Parameters"</strong> first. This will auto-fill the individual bundle radii for you.
                </div>

                <h2 id="guide-step2">Step 2: Place Conductors (Center Panel)</h2>
                <p>The canvas is your interactive workspace. All your actions here apply to the "Active Bundle" selected in the left panel.</p>
                
                <h4>Controls & Hotkeys</h4>
                <ul>
                    <li><strong>Click:</strong> Place a conductor at your cursor's location.</li>
                    <li><strong>Hold <code>Shift</code>:</strong> Constrains the "preview line" to perfect horizontal or vertical angles from your last-placed point.</li>
                    <li><strong>Press <code>Tab</code>:</strong> Opens a dialog to place the next point with a precise <strong>Length</strong> and <strong>Angle</strong> from the last point.</li>
                    <li><strong>Press <code>Esc</code>:</strong> Clears the "preview line" anchor, allowing you to start placing a new set of conductors.</li>
                </ul>
                
                <h4>Visual Feedback</h4>
                <ul>
                    <li><strong>Coordinate Display:</strong> A real-time (x, y) coordinate tracker follows your mouse.</li>
                    <li><strong>Preview Line:</strong> A dashed line shows the distance/angle from your last click to your current cursor position.</li>
                    <li><strong>Snap Halo:</strong> A yellow circle appears when you hover near an existing point, allowing you to "snap" to it for perfect alignment.</li>
                </ul>

                <h2 id="guide-step3">Step 3: Review Results (Right Panel)</h2>
                <p>This panel updates **in real-time** with every change you make (placing a point, changing a parameter, etc.).</p>
                <ul>
                    <li><strong>GMR ($D_s$):</strong> The calculated Geometric Mean Radius for each phase bundle.</li>
                    <li><strong>GMD ($D_{eq}$):</strong> The Geometric Mean Distance between each pair of phases (A-B, B-C, A-C).</li>
                    <li><strong>Line Parameters:</strong> A full breakdown of R, L, C (per km and total) and the line's reactances ($X_L$, $X_C$) at the specified frequency.</li>
                </ul>
                
                <h2 id="guide-step4">Step 4: Export Solution (Left Panel)</h2>
                <p>At the bottom of the Left Panel, you can generate a formal, multi-page report of your work.</p>
                <ol>
                    <li>Enter your Google Gemini API key.</li>
                    <li>Click <strong>"Generate LaTeX Solution"</strong>. A loading modal will appear.</li>
                    <li>A new modal will open, displaying the complete LaTeX code for your report.</li>
                    <li>From this modal, you can:
                        <ul>
                            <li><strong>Copy to Clipboard:</strong> Copy the raw LaTeX code to use in your own editor.</li>
                            <li><strong>Download .tex:</strong> Save the report as a `.tex` file.</li>
                            <li><strong>Export as PDF:</strong> This button sends the LaTeX to the backend, which compiles it into a PDF and opens a "Save As..." dialog.</li>
                        </ul>
                    </li>
                </ol>
                <div class="highlight">
                    <strong>PDF Export Requires LaTeX:</strong> To use the "Export as PDF" feature, you must have a LaTeX distribution (like <strong>TeX Live</strong> or <strong>MiKTeX</strong>) installed on your computer.
                </div>
            </section>
            
            <section id="api-reference">
                <h1>API Reference</h1>
                <p>The application functions via a <code>pywebview</code> API bridge, allowing JavaScript to call Python functions and receive data in return.</p>
                
                <h2 id="api-backend">Python Backend API</h2>
                <p>The <code>GMDGMRApp</code> class in Python holds the application state and exposes methods to the JavaScript frontend.</p>
                
                <h3 id="api-backend-class">Class: GMDGMRApp</h3>
                <p>This class is instantiated once and serves as the single source of truth for all calculations. All coordinates and parameters are stored as attributes of this class instance.</p>
                
                <h3 id="api-backend-methods">Backend Methods</h3>
                <p>These functions are called from JavaScript via <code>await pywebview.api.function_name(...)</code>.</p>
                
                <p class="api-def">set_unit(<strong>u: str</strong>) &rarr; <code>str</code></p>
                <p>Sets the active unit for canvas inputs (e.g., 'm', 'ft').</p>
                
                <p class="api-def">set_gmr(<strong>bundle: str, val: float</strong>) &rarr; <code>str</code></p>
                <p>Converts the provided <strong>physical radius</strong> <code>val</code> from the current unit to meters, calculates its GMR ($r' = \text{val_meters} \times 0.7788$), and stores it.</p>
                
                <p class="api-def">set_line_params(<strong>material: str, length: float, radius: float, freq: float</strong>) &rarr; <code>str</code></p>
                <p>Updates all core line parameters. <code>radius</code> is the master radius in **meters**. This function also syncs all individual bundle GMRs ($r'$) based on this new radius.</p>
                
                <p class="api-def">add_point(<strong>x: float, y: float, bundle: str</strong>) &rarr; <code>str</code></p>
                <p>The primary data entry function. It takes the <code>x</code>, <code>y</code> coordinates (in user units), converts them to **meters**, and appends them to the correct list in `self.bundles`.</p>
                
                <p class="api-def">clear_bundle(<strong>bundle: str</strong>) &rarr; <code>str</code></p>
                <p>Empties the coordinate list for the specified bundle (e.g., `self.bundles['A'] = []`).</p>
                
                <p class="api-def">clear_all() &rarr; <code>str</code></p>
                <p>Empties the coordinate lists for all bundles.</p>
                
                <p class="api-def">compute_results() &rarr; <code>dict</code></p>
                <p>The main calculation engine. Gathers all current state data, performs all `compute_gmr` and `compute_gmd` calls, calculates R, L, and C, and returns all results in a single JSON dictionary.</p>
                
                <p class="api-def">export_latex_solution(<strong>api_key: str</strong>) &rarr; <code>str</code></p>
                <p>Builds a comprehensive prompt for the Gemini AI, including all inputs and results, and returns the AI-generated LaTeX document as a string.</p>
                
                <p class="api-def">generate_pdf_from_latex(<strong>latex_content: str</strong>) &rarr; <code>dict</code></p>
                <p>Uses a `subprocess` to call `pdflatex` on the system, compiling the provided LaTeX string into a PDF and prompting the user to save it.</p>

                <h2 id="api-frontend">JavaScript Frontend API</h2>
                <p>The frontend JavaScript orchestrates the UI, captures all user events, and acts as the client for the Python API.</p>
                
                <h3 id="api-frontend-state">Global State Variables</h3>
                <ul>
                    <li><code>bundles = {A: [], B: [], C: []}</code>: A JavaScript *mirror* of the Python coordinates. This is used for all high-frequency drawing operations on the canvas to avoid slow API calls.</li>
                    <li><code>activeBundle = 'A'</code>: The currently selected bundle (A, B, or C).</li>
                    <li><code>lastPlacedPoint = null</code>: The *canvas pixel* `{x, y}` coordinate of the last click. This is the anchor for drawing preview lines and TAB-based placement.</li>
                    <li><code>shiftKeyPressed = false</code>: A boolean flag updated by global key listeners.</li>
                </ul>

                <h3 id="api-frontend-events">Core Event Handlers</h3>
                
                <div class="code-block-wrapper">
                    <button class="copy-btn">Copy</button>
<pre><code>canvas.addEventListener('mousemove', (e) => {
    // 1. Calculate mouse (x,y) coordinates
    // 2. Update coordDisplay text
    // 3. Find nearest snap point via findSnapPoint()
    // 4. Call redraw()
});</code></pre>
                </div>
                
                <div class="code-block-wrapper">
                    <button class="copy-btn">Copy</button>
<pre><code>canvas.addEventListener('click', async (e) => {
    // 1. Determine final (x,y) from click/snap/shift
    // 2. await pywebview.api.add_point(x, y, activeBundle);
    // 3. bundles[activeBundle].push([x, y]);
    // 4. set lastPlacedPoint = {pixelX, pixelY};
    // 5. await updateResults();
});</code></pre>
                </div>
                
                <p class="api-def">updateResults()</p>
                <p>This async function is the heart of the UI-backend sync. It calls <code>await pywebview.api.compute_results()</code> and then uses the returned JSON to build an HTML string and inject it into the `div#results` panel.</p>

                <h3 id="api-frontend-drawing">The Drawing Loop</h3>
                
                <p class="api-def">redraw()</p>
                <p>The master drawing function called on every mouse move and click. It executes in a specific order to ensure correct layering:</p>
                <ol>
                    <li><code>ctx.clearRect()</code>: Wipes the entire canvas.</li>
                    <li><code>drawGrid()</code>: Draws the background grid and axes.</li>
                    <li><code>drawBundleCircle()</code> / <code>drawBundleConnections()</code>: Draws the visual lines *within* each bundle.</li>
                    <li><code>drawPoints()</code>: Draws the conductor points and their labels (e.g., "A1", "A2").</li>
                    <li><code>drawSnapIndicator()</code>: Draws the yellow snap halo if `snapPoint` is active.</li>
                    <li><code>drawPreviewLine()</code>: Draws the dashed preview line from `lastPlacedPoint` to the cursor.</li>
                </ol>

            </section>
            
            <section id="math-hub">
                <h1>Mathematical Hub</h1>
                <p>This section details the core formulas used by the <code>GMRGMDTEST.py</code> backend to perform the calculations.</p>
                
                <h2 id="math-gmr">GMR / Self GMD ($D_s$)</h2>
                <p>The <strong>Geometric Mean Radius (GMR)</strong>, also known as Self GMD, represents the equivalent radius of a conductor or bundle. It is a hypothetical radius that accounts for the conductor's internal magnetic flux.</p>
                
                <h4>Single Solid Conductor</h4>
                <p>For a single, solid cylindrical conductor, the GMR is a fixed fraction of its physical radius (r):</p>
                <img class="math-formula" src="https://latex.codecogs.com/svg.png?D_s = r' = r \times e^{-1/4} \approx r \times 0.7788" alt="GMR of single conductor">
                
                <h4>Bundled Conductors (n > 1)</h4>
                <p>For a bundle of <i>n</i> conductors, the GMR is the $n^2$-th root of the product of $n^2$ distances. These distances are the $n$ GMRs of the individual conductors (r') and the $n(n-1)$ distances between all pairs of conductors (counted twice).</p>
                <p>Assuming all conductors have the same $r'$, this simplifies to the formula used in the code:</p>
                <img class="math-formula" src="https://latex.codecogs.com/svg.png?D_s = \sqrt[n^2]{(r')^n \times (D_{12}D_{13}...D_{n-1,n})^2}" alt="Simplified GMR formula">
                
                <h4>Example (n=2 conductors):</h4>
                <img class="math-formula" src="https://latex.codecogs.com/svg.png?D_s = \sqrt[4]{(r')^2 \times (D_{12})^2} = \sqrt{r' \times D_{12}}" alt="GMR for n=2">

                <h4>Example (n=3 conductors, e.g., triangle):</h4>
                <img class="math-formula" src="https://latex.codecogs.com/svg.png?D_s = \sqrt[9]{(r')^3 \times (D_{12} \cdot D_{13} \cdot D_{23})^2}" alt="GMR for n=3">
                
                <h2 id="math-gmd">GMD / Mutual GMD ($D_{eq}$)</h2>
                <p>The <strong>Geometric Mean Distance (GMD)</strong>, or Mutual GMD, represents the equivalent distance between two separate phase bundles (e.g., between Phase A and Phase B).</p>
                <p>If Bundle A has <i>m</i> conductors and Bundle B has <i>n</i> conductors, there are $m \times n$ total distances between them. The GMD is the ($mn$)-th root of the product of all these distances.</p>
                <img class="math-formula" src="https://latex.codecogs.com/svg.png?D_{AB} = \sqrt[mn]{\prod_{i=1}^{m} \prod_{j=1}^{n} D_{a_i b_j}}" alt="General GMD formula">
                
                <p>For a 3-phase system, this is calculated for $D_{AB}$, $D_{BC}$, and $D_{AC}$. The equivalent GMD for the whole system is the geometric mean of these three values:</p>
                <img class="math-formula" src="https://latex.codecogs.com/svg.png?D_{eq} = \sqrt[3]{D_{AB} \cdot D_{BC} \cdot D_{AC}}" alt="Equivalent GMD">
                
                <h2 id="math-rlc">Line Parameters (R, L, C)</h2>
                <p>Once $D_s$ (avg. GMR) and $D_{eq}$ (avg. GMD) are known, the line parameters are calculated.</p>
                
                <h4>Resistance (R)</h4>
                <p>Resistance is calculated based on material resistivity ($\rho$), length ($L_{km}$), cross-sectional area ($A = \pi r^2$), and the number of conductors in the bundle ($N$).</p>
                <img class="math-formula" src="https://latex.codecogs.com/svg.png?R_{\text{per\_km}} = \frac{\rho \times 1000}{A \times N_{\text{bundle}}} \; (\Omega / \text{km})" alt="Resistance formula">
                
                <h4>Inductance (L)</h4>
                <p>Inductance depends on the ratio of GMD to GMR.</p>
                <img class="math-formula" src="https://latex.codecogs.com/svg.png?L_{\text{per\_km}} = \left( 2 \times 10^{-7} \ln\left(\frac{D_{eq}}{D_s}\right) \right) \times 1000 \; (\text{mH} / \text{km})" alt="Inductance formula">
                <p>Total Inductive Reactance is then $X_L = 2 \pi f L_{\text{total}}$.</p>
                
                <h4>Capacitance (C)</h4>
                <p>Capacitance is similar, but it uses the <strong>equivalent bundle radius ($r_b$)</strong> instead of GMR. $r_b$ is calculated using the same GMR formula, but with the physical radius $r$ instead of $r'$.</p>
                <img class="math-formula" src="https://latex.codecogs.com/svg.png?C_{\text{per\_km}} = \left( \frac{2 \pi \epsilon_0}{\ln\left(\frac{D_{eq}}{r_b}\right)} \right) \times 10^9 \; (\text{nF} / \text{km})" alt="Capacitance formula">
                <p>Where $\epsilon_0 = 8.854 \times 10^{-12} \text{ F/m}$. Total Capacitive Reactance is $X_C = \frac{1}{2 \pi f C_{\text{total}}}$.</p>
            </section>
        </div>
    </main>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- Copy Button Functionality ---
    document.querySelectorAll('.copy-btn').forEach(button => {
        button.addEventListener('click', () => {
            const pre = button.nextElementSibling;
            const code = pre.querySelector('code') || pre;
            const text = code.innerText;

            navigator.clipboard.writeText(text).then(() => {
                button.innerText = 'Copied!';
                button.classList.add('copied');
                setTimeout(() => {
                    button.innerText = 'Copy';
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        });
    });

    // --- Scroll-Spy Functionality ---
    const sidebar = document.getElementById('sidebar');
    const navLinks = sidebar.querySelectorAll('.sidebar-nav li');
    const sections = document.querySelectorAll('.content section, .content h2, .content h3');
    
    // Create a map of section IDs to nav links
    const navMap = {};
    navLinks.forEach(link => {
        const spyId = link.getAttribute('data-scroll-spy');
        if (spyId) {
            navMap[spyId] = link;
        }
    });

    // Use IntersectionObserver for efficient scroll spying
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const id = entry.target.id;
                if (navMap[id]) {
                    // Remove 'active' from all
                    navLinks.forEach(link => link.classList.remove('active'));
                    
                    // Add 'active' to the current one
                    let currentLink = navMap[id];
                    currentLink.classList.add('active');
                    
                    // Also activate parent nav items
                    let parent = currentLink.closest('ul')?.closest('li');
                    while(parent) {
                        parent.classList.add('active');
                        parent = parent.closest('ul')?.closest('li');
                    }
                }
            }
        });
    }, {
        rootMargin: '0px 0px -80% 0px', // Triggers when the top 20% of the section is visible
        threshold: 0
    });

    // Observe all sections that have an ID
    document.querySelectorAll('.content section[id], .content h2[id], .content h3[id]').forEach(section => {
        observer.observe(section);
    });

});
</script>

</body>
</html>